# =============================================================================
# MuleGuard Rules Configuration
# Migration Scope: Mule 4.3.x/4.4.x/4.6.x â†’ 4.9.0 + JDK 17 + Policy Modernization + RTF 4.3
# Author: Rakesh Kumar (rakesh.kumar@ibm.com, raksjnu@gmail.com)
# =============================================================================

# =============================================================================
# RULE TYPES QUICK REFERENCE
# =============================================================================
# 
# CODE RULE TYPES (12 Standard Types - Apply to Mule API Projects)
# -------------------------------------------------------------------------
# 1.  GENERIC_TOKEN_SEARCH_REQUIRED      - Ensures required tokens exist in files
# 2.  GENERIC_TOKEN_SEARCH_FORBIDDEN     - Ensures forbidden tokens do NOT exist in files
# 3.  XML_XPATH_EXISTS                   - Validates required XPath expressions exist in XML
# 4.  XML_XPATH_NOT_EXISTS               - Validates forbidden XPath expressions do NOT exist in XML
# 5.  XML_ATTRIBUTE_EXISTS               - Ensures required XML attributes exist with correct values
# 6.  XML_ATTRIBUTE_NOT_EXISTS           - Ensures forbidden XML attributes do NOT exist
# 7.  XML_ELEMENT_CONTENT_REQUIRED       - Validates required content exists within XML elements
# 8.  XML_ELEMENT_CONTENT_FORBIDDEN      - Validates forbidden content does NOT exist within XML elements
# 9.  POM_VALIDATION_REQUIRED            - Ensures required POM elements exist (parent, dependencies, plugins, properties)
# 10. POM_VALIDATION_FORBIDDEN           - Ensures forbidden POM elements do NOT exist (dependencies, plugins)
# 11. JSON_VALIDATION_REQUIRED           - Validates required JSON elements exist (mule-artifact.json)
# 12. JSON_VALIDATION_FORBIDDEN          - Validates forbidden JSON elements do NOT exist
#
# CONFIG RULE TYPES (5 Standard Types - Apply to Configuration Projects)
# -------------------------------------------------------------------------
# 1.  MANDATORY_SUBSTRING_CHECK          - Ensures required substrings exist in config files (.properties, .policy)
# 2.  MANDATORY_PROPERTY_VALUE_CHECK     - Validates required properties exist with correct values
# 3.  OPTIONAL_PROPERTY_VALUE_CHECK      - Validates property values IF the property exists
# 4.  GENERIC_TOKEN_SEARCH               - Advanced token search with REGEX support and environment filtering
# 5.  CLIENTIDMAP_VALIDATOR              - Custom validator for secure properties and client ID mappings
#
# =============================================================================

config:
  # Project Identification Configuration
  # Defines how to identify different types of projects in the root folder
  
  projectIdentification:
    # Configuration Folder Identification
    # Config folders are identified by naming pattern (regex)
    configFolder:
      # Regex pattern to match config folder names
      # Default: ".*_config.*" matches any folder containing "_config"
      # Examples: "muleapp1_config", "api_config_v2", "test_config"
      namePattern: ".*_config.*"
      
      # Alternative patterns (if you want to match multiple patterns, use regex OR: "pattern1|pattern2")
      # Example: ".*_config.*|.*-config.*" matches both "_config" and "-config"
    
    # Mule API Project Identification
    # Mule code projects are identified by the presence of specific files
    muleApiProject:
      # Match mode: how to evaluate marker files
      # "ANY" = At least ONE marker file must exist (OR logic)
      # "ALL" = ALL marker files must exist (AND logic)
      matchMode: "ALL"  # Require BOTH pom.xml AND mule-artifact.json
      
      # List of marker files to check
      # Default: ["pom.xml", "mule-artifact.json"]
      markerFiles:
        - "pom.xml"
        - "mule-artifact.json"
      
      # Optional: Additional marker files (uncomment to add more)
      # - "build.gradle"
      # - "mule-app.properties"
    
    # Folders to Ignore
    # These folders will be skipped during validation
    ignoredFolders:
      # Exact folder names to ignore (case-sensitive)
      exactNames:
        - "muleguard-reports"
        - "target"
        - "bin"
        - "build"
        - ".git"
        - ".idea"
        - ".vscode"
        - "node_modules"
      
      # Folder name prefixes to ignore (folders starting with these)
      prefixes:
        - "."  # Ignore all hidden folders (starting with dot)
  
  # Numeric range for rules that should ONLY apply to configuration projects
  rules:
    start: 100
    end: 199
  
  # Global list of environments to be used by config rules
  environments:
    - "SBX"
    - "ATDV"
    - "TDV1"
    - "TDV"
    - "IBF"
    - "MNE"
    - "MNE1"
    - "MNE2"
    - "ITE"
    - "PITE"
    - "PREP"
    - "DRL"
    - "TRN"
    - "PROD"
    - "DR"

# =============================================================================
# CODE RULES (RULE-000 to RULE-099)
# Apply to Mule API Projects
# =============================================================================

rules:
  # ---------------------------------------------------------------------------
  # GENERIC_TOKEN_SEARCH_FORBIDDEN - Forbidden Token Detection
  # ---------------------------------------------------------------------------
  - id: "RULE-000"
    name: "Generic Code Check - Forbidden Tokens"
    description: "Scans configured files for forbidden tokens. Fails if tokens are found."
    enabled: true
    severity: "HIGH"
    checks:
      - type: "GENERIC_TOKEN_SEARCH_FORBIDDEN"
        params:
          filePatterns:
            - "src/main/mule/*.xml"
            - "src/main/resources/*.dwl"
          tokens:
            - "SAMPLE_DONT_USE_TOKEN"
          matchMode: SUBSTRING
          caseSensitive: true

  # ---------------------------------------------------------------------------
  # POM_VALIDATION_REQUIRED - Parent POM Validation
  # ---------------------------------------------------------------------------
  - id: "RULE-001"
    name: "Update pom parent: MuleParentPom version:LATEST"
    description: "Parent pom must be com.raks.eapi:MuleParentPom:LATEST"
    enabled: true
    severity: LOW
    checks:
      - type: POM_VALIDATION_REQUIRED
        params:
          validationType: PARENT
          parent:
            groupId: "com.raks.eapi"
            artifactId: "MuleParentPom"
            version: "LATEST"

  # ---------------------------------------------------------------------------
  # POM_VALIDATION_REQUIRED - Properties Validation
  # ---------------------------------------------------------------------------
  - id: "RULE-002"
    name: "Update pom property: mule.maven.plugin.version to 4.9.0"
    enabled: true
    severity: LOW
    checks:
      - type: POM_VALIDATION_REQUIRED
        params:
          validationType: PROPERTIES
          properties:
            - name: "mule.maven.plugin.version"
              expectedValue: "4.5.0"
            - name: "app.runtime"
              expectedValue: "4.9.0"

  # ---------------------------------------------------------------------------
  # POM_VALIDATION_FORBIDDEN - Forbidden Plugins
  # ---------------------------------------------------------------------------
  - id: "RULE-003"
    name: "Remove pom plugin: maven-clean-plugin"
    enabled: true
    severity: MEDIUM
    checks:
      - type: POM_VALIDATION_FORBIDDEN
        params:
          validationType: PLUGINS
          forbiddenPlugins:
            - groupId: "org.apache.maven.plugins"
              artifactId: "maven-clean-plugin"
            - groupId: "org.apache.maven.plugins"
              artifactId: "maven-surefire-plugin"

  # ---------------------------------------------------------------------------
  # POM_VALIDATION_FORBIDDEN - Forbidden Dependencies
  # ---------------------------------------------------------------------------
  - id: "RULE-004"
    name: "Remove pom dependency: spring-security-ldap, spring-security-web, mule-module-spring-config, and db2jcc_license_cu"
    enabled: true
    severity: MEDIUM
    checks:
      - type: POM_VALIDATION_FORBIDDEN
        params:
          validationType: DEPENDENCIES
          forbiddenDependencies:
            - groupId: "org.springframework.security"
              artifactId: "spring-security-ldap"
            - groupId: "org.springframework.security"
              artifactId: "spring-security-web"
            - groupId: "org.mule.modules"
              artifactId: "mule-module-spring-config"
            - groupId: "com.ibm.db2"
              artifactId: "db2jcc_license_cu"
            - groupId: "com.mulesoft.mule.core"
              artifactId: "mule-core-ee"
            - groupId: "com.mulesoft.mule.runtime.modules"
              artifactId: "mule-module-spring-config-ee"

  # ---------------------------------------------------------------------------
  # XML_ATTRIBUTE_EXISTS - IBM MQ Cipher Suite Validation
  # ---------------------------------------------------------------------------
  - id: "RULE-005" 
    name: "Validate IBM MQ Connector Cipher Suite"
    description: "The IBM MQ connector configuration must use the approved cipher suite."
    enabled: true
    severity: HIGH
    checks:
      - type: XML_ATTRIBUTE_EXISTS
        params:
          filePatterns: ["src/main/mule/*.xml"]
          propertyResolution: true
          caseSensitive: true
          elementAttributeSets:
            - element: "ibm:connection"
              attributes:
                cipherSuite: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"

  # ---------------------------------------------------------------------------
  # POM_VALIDATION_REQUIRED - Required Dependencies
  # ---------------------------------------------------------------------------
  - id: "RULE-006"
    name: "Add pom dependency: apimuleutilities for JCE Encrypt/Decrypt"
    enabled: true
    severity: HIGH
    checks:
      - type: POM_VALIDATION_REQUIRED
        params:
          validationType: DEPENDENCIES
          dependencies:
            - groupId: "com.raks.eapi"
              artifactId: "apimuleutilities"

  # ---------------------------------------------------------------------------
  # JSON_VALIDATION_REQUIRED - mule-artifact.json Validation
  # ---------------------------------------------------------------------------
  - id: "RULE-007"
    name: "Validate mule-artifact.json (Mule 4.9+, Java 17, secureProperties)"
    description: "Ensures mule-artifact.json meets minimum runtime and security requirements"
    enabled: true
    severity: HIGH
    checks:
      - type: JSON_VALIDATION_REQUIRED
        params:
          filePattern: "mule-artifact.json"
          minVersions:
            minMuleVersion: "4.9.0"
          requiredFields:
            javaSpecificationVersions: "17"
          requiredElements:
            - "secureProperties"

  # ---------------------------------------------------------------------------
  # XML_XPATH_EXISTS - API Autodiscovery Check
  # ---------------------------------------------------------------------------
  - id: "RULE-008"
    name: "Check for api-gateway:autodiscovery"
    description: "Verifies that the api-gateway:autodiscovery element is present in a Mule configuration file."
    enabled: true
    severity: MEDIUM
    checks:
      - type: XML_XPATH_EXISTS
        params:
          filePatterns: ["src/main/mule/*.xml"]
          xpathExpressions:
            - xpath: "//*[local-name()='autodiscovery']"
              failureMessage: "API Autodiscovery is not enabled. The <api-gateway:autodiscovery> element is missing."

  # ---------------------------------------------------------------------------
  # GENERIC_TOKEN_SEARCH_FORBIDDEN - Unsupported Error Handling
  # ---------------------------------------------------------------------------
  - id: "RULE-009"
    name: "Remove unsupported error handling expressions"
    description: "Scans for legacy error expressions like error.errorType, error.muleMessage, etc., which are not supported in modern Mule 4 error handling."
    enabled: true
    severity: HIGH
    checks:
      - type: GENERIC_TOKEN_SEARCH_FORBIDDEN
        params:
          filePatterns: ["src/main/mule/*.xml", "src/main/resources/*.dwl"]
          tokens:
            - "error.errorType"
            - "error.muleMessage"
            - "error.exception"
            - "error.errors"
          matchMode: SUBSTRING
          caseSensitive: true

  # ---------------------------------------------------------------------------
  # XML_ATTRIBUTE_NOT_EXISTS - Forbidden Attributes
  # ---------------------------------------------------------------------------
  - id: "RULE-010"
    name: "Remove unsupported from/to ApplicationCode attributes"
    description: "Scans for fromApplicationCode or toApplicationCode attributes in logging connector elements."
    enabled: true
    severity: HIGH
    checks:
      - type: XML_ATTRIBUTE_NOT_EXISTS
        params:
          filePatterns: ["src/main/mule/*.xml"]
          elements:
            - "request_in"
            - "request_out"
            - "response_in"
            - "response_out"
            - "ee:transform"
          forbiddenAttributes:
            - "fromApplicationCode"
            - "toApplicationCode"
            - "doc:id"

  # ---------------------------------------------------------------------------
  # GENERIC_TOKEN_SEARCH_FORBIDDEN - DLP References
  # ---------------------------------------------------------------------------
  - id: "RULE-011"
    name: "Check for DLP references"
    description: "Scans for specific DLP-related property references in configuration and property files."
    enabled: true
    severity: HIGH
    checks:
      - type: GENERIC_TOKEN_SEARCH_FORBIDDEN
        params:
          filePatterns:
            - "mule/http-proxy.xml"
            - "resources/*.properties"
          tokens:
            - "north.bound.dlp.flag"
            - "south.bound.dlp.flag"
            - "wmq.dlp.requestqueue"
          matchMode: SUBSTRING
          caseSensitive: true

  # ---------------------------------------------------------------------------
  # XML_ELEMENT_CONTENT_FORBIDDEN - Legacy JCE Encryption
  # ---------------------------------------------------------------------------
  - id: "RULE-012"
    name: "Check for legacy JCE PBE encryption algorithm"
    description: "Scans for the usage of PBEWithHmacSHA256AndAES_256 in crypto:jce-encrypt-pbe elements."
    enabled: true
    severity: HIGH
    checks:
      - type: XML_ELEMENT_CONTENT_FORBIDDEN
        params:
          filePatterns: ["src/main/mule/*.xml"]
          matchMode: SUBSTRING
          caseSensitive: true
          elementTokenPairs:
            - element: "crypto:jce-encrypt-pbe"
              forbiddenTokens: ["PBEWithHmacSHA256AndAES_256"]

  # ---------------------------------------------------------------------------
  # XML_ATTRIBUTE_EXISTS - Crypto Config Type Check
  # ---------------------------------------------------------------------------
  - id: "RULE-013"
    name: "Check for 'type' attribute in crypto:jce-config"
    description: "Ensures that any crypto:jce-config element has the 'type' attribute defined."
    enabled: true
    severity: HIGH
    checks:
      - type: XML_ATTRIBUTE_EXISTS
        params:
          filePatterns: ["src/main/mule/*.xml"]
          elements: ["crypto:jce-config"]
          attributes: ["type"]

  # ---------------------------------------------------------------------------
  # XML_ELEMENT_CONTENT_FORBIDDEN - toBase64 in set-variable
  # ---------------------------------------------------------------------------
  - id: "RULE-014"
    name: "Check for toBase64 in set-variable"
    description: "Scans for the use of the 'toBase64' token within a 'set-variable' element."
    enabled: true
    severity: HIGH
    checks:
      - type: XML_ELEMENT_CONTENT_FORBIDDEN
        params:
          filePatterns: ["src/main/mule/*.xml"]
          matchMode: SUBSTRING
          caseSensitive: true
          elementTokenPairs:
            - element: "set-variable"
              forbiddenTokens: ["toBase64"]
          matchMode: ELEMENT_ATTRIBUTE

  # ---------------------------------------------------------------------------
  # XML_ATTRIBUTE_EXISTS - HTTP Listener Path Validation
  # ---------------------------------------------------------------------------
  - id: "RULE-015" 
    name: "Validate HTTP Listener Path"
    description: "The HTTP listener configuration must use the approved path."
    enabled: true
    severity: HIGH
    checks:
      - type: XML_ATTRIBUTE_EXISTS
        params:
          filePatterns: ["src/main/mule/*.xml"]
          propertyResolution: true
          caseSensitive: true
          elementAttributeSets:
            - element: "http:listener"
              attributes:
                path: "/test"

  # ---------------------------------------------------------------------------
  # TEMPLATE RULES - Disabled Reference Examples for Unused Rule Types
  # ---------------------------------------------------------------------------

  # GENERIC_TOKEN_SEARCH_REQUIRED - Template (Currently Not Used)
  - id: "RULE-017"
    name: "[TEMPLATE] Required Token Search"
    description: "Template for ensuring required tokens exist in files. Enable and configure as needed."
    enabled: false
    severity: MEDIUM
    checks:
      - type: GENERIC_TOKEN_SEARCH_REQUIRED
        params:
          filePatterns: ["src/main/mule/*.xml"]
          tokens:
            - "REQUIRED_TOKEN_EXAMPLE"
          matchMode: SUBSTRING
          caseSensitive: true

  # XML_XPATH_NOT_EXISTS - Template (Currently Not Used)
  - id: "RULE-018"
    name: "[TEMPLATE] Forbidden XPath Check"
    description: "Template for ensuring forbidden XPath expressions do NOT exist. Enable and configure as needed."
    enabled: false
    severity: MEDIUM
    checks:
      - type: XML_XPATH_NOT_EXISTS
        params:
          filePatterns: ["src/main/mule/*.xml"]
          xpathExpressions:
            - xpath: "//*[local-name()='forbidden-element']"
              failureMessage: "Forbidden element found in XML"

  # XML_ELEMENT_CONTENT_REQUIRED - Template (Currently Not Used)
  - id: "RULE-019"
    name: "[TEMPLATE] Required Element Content"
    description: "Template for ensuring required content exists within XML elements. Enable and configure as needed."
    enabled: false
    severity: MEDIUM
    checks:
      - type: XML_ELEMENT_CONTENT_REQUIRED
        params:
          filePatterns: ["src/main/mule/*.xml"]
          matchMode: SUBSTRING
          caseSensitive: true
          elementTokenPairs:
            - element: "some:element"
              requiredTokens: ["REQUIRED_CONTENT"]

  # JSON_VALIDATION_FORBIDDEN - Template (Currently Not Used)
  - id: "RULE-016"
    name: "[TEMPLATE] Forbidden JSON Elements"
    description: "Template for ensuring forbidden JSON elements do NOT exist. Enable and configure as needed."
    enabled: false
    severity: MEDIUM
    checks:
      - type: JSON_VALIDATION_FORBIDDEN
        params:
          filePattern: "mule-artifact.json"
          forbiddenElements:
            - "deprecatedField"

# =============================================================================
# CONFIGURATION RULES (RULE-100 to RULE-199)
# Apply to Configuration Projects Only
# =============================================================================

  # ---------------------------------------------------------------------------
  # MANDATORY_SUBSTRING_CHECK - .properties Files
  # ---------------------------------------------------------------------------
  - id: "RULE-100"
    name: "Mandatory substring check for .properties files"
    description: "Scans .properties files for required tokens (exact substring match)"
    enabled: true
    severity: HIGH
    checks:
      - type: MANDATORY_SUBSTRING_CHECK
        params:
          fileExtensions: [".properties"]
          caseSensitive: true  # Exact case-sensitive substring match
          environments: ["ALL"]  # Check all environments
          tokens:
            - "apiId"
  
  # ---------------------------------------------------------------------------
  # MANDATORY_PROPERTY_VALUE_CHECK - .properties Files
  # ---------------------------------------------------------------------------
  - id: "RULE-101"
    name: "Mandatory name-value check for .properties files"
    description: "Ensures required properties exist with correct values in .properties files"
    enabled: true
    severity: HIGH
    checks:
      - type: MANDATORY_PROPERTY_VALUE_CHECK
        params:
          fileExtensions: [".properties"]
          delimiter: "="
          caseSensitiveNames: true   # Property names are case-sensitive
          caseSensitiveValues: true  # Property values are case-sensitive
          environments: ["ALL"]  # Check all environments
          properties:
            - name: "LogJsonFormat"
              values: ["true","false"]
            - name: "anotherpropertycheck"
              values: ["somevalue"]

  # ---------------------------------------------------------------------------
  # MANDATORY_SUBSTRING_CHECK - .policy Files
  # ---------------------------------------------------------------------------
  - id: "RULE-102"
    name: "Mandatory substring check for .policy files"
    description: "Scans .policy files for required tokens (exact substring match)"
    enabled: true
    severity: HIGH
    checks:
      - type: MANDATORY_SUBSTRING_CHECK
        params:
          fileExtensions: [".policy"]
          caseSensitive: true
          environments: ["ALL"]  # Check all environments
          tokens:
            - "http.protocols=HTTPS"
            - "http.private.port=8081"

  # ---------------------------------------------------------------------------
  # MANDATORY_PROPERTY_VALUE_CHECK - .policy Files
  # ---------------------------------------------------------------------------
  - id: "RULE-103"
    name: "Mandatory name-value check for .policy files"
    description: "Ensures required policy properties exist with correct values"
    enabled: true
    severity: HIGH
    checks:
      - type: MANDATORY_PROPERTY_VALUE_CHECK
        params:
          fileExtensions: [".policy"]
          delimiter: "="
          caseSensitiveNames: true
          caseSensitiveValues: true
          environments: ["ALL"]  # Check all environments
          properties:
            # Header Injection Policy
            - name: "headerinjection.policy.applied"
              values: ["true"]
            - name: "headerinjection.policy.version"
              values: ["1.3.2", "1.3.3"]  # Allow multiple versions
            
            # Rate Limit Policy
            - name: "ratelimit.policy.applied"
              values: ["true"]
            - name: "ratelimit.policy.version"
              values: ["1.4.2"]
            
            # Composite Authentication Policy
            - name: "truist.compositeauthn.policy.applied"
              values: ["true"]
            - name: "truist.compositeauthn.policy.version"
              values: ["3.0.0"]
            
            # Authorization Policy
            - name: "truist.authz.policy.applied"
              values: ["true"]
            - name: "truist.authz.policy.version"
              values: ["3.0.0"]

            # Asset Type
            - name: "assetType"
              values: ["rest","soap","batch"]

  # ---------------------------------------------------------------------------
  # CLIENTIDMAP_VALIDATOR - Custom Validators
  # ---------------------------------------------------------------------------
  - id: "RULE-104"
    name: "Validate properties files for correct property details"
    description: "Validates that .properties files contain required configuration properties using custom validators"
    enabled: true
    severity: MEDIUM
    checks:
      # Secure encrypted properties - using custom validator
      - type: CLIENTIDMAP_VALIDATOR
        description: "Validate secure encrypted properties"
        params:
          validationType: "SECURE"
          fileExtensions: [".properties"]
          environments: ["ALL"]  # Support environment selection
      
      # Client ID mapping validation - using custom validator with strict format checking
      - type: CLIENTIDMAP_VALIDATOR
        description: "Validate authorization policy client ID mappings"
        params:
          validationType: "CLIENTIDMAP"
          fileExtensions: [".policy"]
          environments: ["ALL"]  # Support environment selection

  # ---------------------------------------------------------------------------
  # OPTIONAL_PROPERTY_VALUE_CHECK - .properties Files
  # ---------------------------------------------------------------------------
  - id: "RULE-105"
    name: "Optional name-value check for .properties files"
    description: "If property exists in .properties files, validates its value"
    enabled: true
    severity: HIGH
    checks:
      - type: OPTIONAL_PROPERTY_VALUE_CHECK
        params:
          fileExtensions: [".properties"]
          delimiter: "="
          caseSensitiveNames: true
          caseSensitiveValues: false  # Example: case-insensitive values
          environments: ["ALL"]
          properties:
            - name: "platform.config.analytics.enabled"
              values: ["true", "false"]
            - name: "requestPathEncryption"
              values: ["Y", "N"]

  # ---------------------------------------------------------------------------
  # OPTIONAL_PROPERTY_VALUE_CHECK - .policy Files
  # ---------------------------------------------------------------------------
  - id: "RULE-106"
    name: "Optional name-value check for .policy files"
    description: "If property exists in .policy files, validates its value"
    enabled: true
    severity: HIGH
    checks:
      - type: OPTIONAL_PROPERTY_VALUE_CHECK
        params:
          fileExtensions: [".policy"]
          delimiter: "="
          caseSensitiveNames: true
          caseSensitiveValues: true
          environments: ["ALL"]
          properties:
            - name: "mTLS-AuthZ.policy.version"
              values: ["3.0.0", "3.0.1"]
            - name: "wssencdec.policy.version"
              values: ["3.0.0", "3.0.1"]

  # ---------------------------------------------------------------------------
  # MANDATORY_SUBSTRING_CHECK - Forbidden Tokens in .properties
  # ---------------------------------------------------------------------------
  - id: "RULE-107"
    name: "Forbidden substring check for .properties files"
    description: "Fails if forbidden tokens are found in .properties files"
    enabled: true
    severity: HIGH
    checks:
      - type: MANDATORY_SUBSTRING_CHECK
        params:
          fileExtensions: [".properties"]
          caseSensitive: true
          searchMode: FORBIDDEN  # Fail if token is found; REQUIRED is other option
          environments: ["ALL"]
          tokens:
            - "hardcoded.password"
            - "TODO"
            - "fixmelater"

  # ---------------------------------------------------------------------------
  # MANDATORY_SUBSTRING_CHECK - Forbidden Tokens in .policy
  # ---------------------------------------------------------------------------
  - id: "RULE-108"
    name: "Forbidden substring check for .policy files"
    description: "Fails if forbidden tokens are found in .policy files"
    enabled: true
    severity: HIGH
    checks:
      - type: MANDATORY_SUBSTRING_CHECK
        params:
          fileExtensions: [".policy"]
          caseSensitive: true
          searchMode: FORBIDDEN  # Fail if token is found; REQUIRED is other option
          environments: ["ALL"]
          tokens:
            - "deprecated.policy"
            - "old.version"

  # ---------------------------------------------------------------------------
  # GENERIC_TOKEN_SEARCH - Regex Pattern Check in .properties
  # ---------------------------------------------------------------------------
  - id: "RULE-109"
    name: "Optional regex pattern (ip addresses) check in .properties files"
    description: "Fails if forbidden regex patterns are found in .properties files"
    enabled: true
    severity: HIGH
    checks:
      - type: GENERIC_TOKEN_SEARCH
        params:
          filePatterns: ["**/Properties/**/*.properties"]  # Match environment config files
          environments: ["ALL"]  # Check all environments or specify: ["ITE", "PROD", "DR"]
          searchMode: FORBIDDEN  # Fail if IP found; use REQUIRED to enforce IPs
          matchMode: REGEX
          tokens:
            # IPv4 pattern: matches xxx.xxx.xxx.xxx format (excluding commented lines)
            - '^(?![\s]*[#!]).*\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b'
            # Localhost variations (excluding commented lines)
            - '^(?![\s]*[#!]).*\blocalhost\b'
            - '^(?![\s]*[#!]).*\b127\.0\.0\.1\b'

  # ---------------------------------------------------------------------------
  # GENERIC_TOKEN_SEARCH - Regex Pattern Check in .policy
  # ---------------------------------------------------------------------------
  - id: "RULE-110"
    name: "Optional regex pattern (ip addresses) check in .policy files"
    description: "Fails if forbidden regex patterns are found in .policy files"
    enabled: true
    severity: HIGH
    checks:
      - type: GENERIC_TOKEN_SEARCH
        params:
          filePatterns: ["**/Policies/*.policy", "**/Policies/**/*.policy"]  # Match both direct and nested policy files
          environments: ["ALL"]  # Check all environments or specify: ["ITE", "PROD", "DR"]
          searchMode: FORBIDDEN  # FORBIDDEN OR REQUIRED; use REQUIRED to enforce IPs ; use FORBIDDEN to exclude IP
          matchMode: REGEX
          tokens:
            # IPv4 pattern: matches xxx.xxx.xxx.xxx format (excluding commented lines)
            - '^(?![\s]*[#!]).*\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b'
            # Localhost variations (excluding commented lines)
            - '^(?![\s]*[#!]).*\blocalhost\b'
            - '^(?![\s]*[#!]).*\b127\.0\.0\.1\b'
