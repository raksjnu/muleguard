<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:api-gateway="http://www.mulesoft.org/schema/mule/api-gateway" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/api-gateway http://www.mulesoft.org/schema/mule/api-gateway/current/mule-api-gateway.xsd">
	<configuration doc:name="Configuration" doc:id="869650ee-32c2-4b1e-88c5-8ab2d96c8cbc" defaultErrorHandler-ref="globalErrorHandler" />
	<api-gateway:autodiscovery apiId="${apiId}" ignoreBasePath="true" doc:name="API Autodiscovery" doc:id="14928706-b46b-421b-9b03-c624010eec02" flowRef="${api-autodeploy-flow-name}" />
	<configuration-properties doc:name="Configuration properties" doc:id="eda66630-a54f-4476-b5ec-26123eadb0ce" file="mule-app.properties" />
	<error-handler name="globalErrorHandler" doc:id="dc84f689-671d-40fc-a6ee-189c63296925" >
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="b1d0437a-5d73-49b8-a0a0-c25ccb8224a7" type="TRANSFORMATION">
			<choice doc:name="Choice" doc:id="1237a78b-7234-4cf2-8ec5-2dd684b2657c" >
				<when expression="#[vars.assetType != 'soap']">
					<ee:transform doc:name="Transform Message" doc:id="8ff6a95e-8ec3-44f9-9cf3-f0b04f24e4d2" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"exception":
	[{
		"errorCode":(error.errorType.namespace default "") ++ "::" ++ (error.errorType.identifier default ""),
		"errorMessage":vars.errorDescription 
	}]
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</when>
				<otherwise >
					<ee:transform doc:name="Transform Message" doc:id="bbc8a329-e797-4553-8886-e69138deb4fd" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/xml

ns soapenv http://schemas.xmlsoap.org/soap/envelope
---
{
	soapenv#soapEnvelope:{
    soapenv#Body:{
    
           soapenv#Fault:{
			faultcode: (error.errorType.namespace default "") ++ "-" ++ (error.errorType.identifier default "") ,
			faultString: error.detailedDescription
	}
	}
	}
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</otherwise>
			</choice>
		</on-error-continue>
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="d761c4f3-b785-4946-a2e0-375135291491" type="ROUTING">
			<choice doc:name="Choice" doc:id="2350f58f-b810-4acb-a6be-bff5a7a02127" >
				<when expression="#[vars.assetType != 'soap']">
					<ee:transform doc:name="Transform Message" doc:id="d092048c-d49a-4f9a-a822-04f7fc0457ed" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"exception":
	[{
		"errorCode":(error.errorType.namespace default "") ++ "::" ++ (error.errorType.identifier default ""),
		"errorMessage":vars.errorDescription 
	}]
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</when>
				<otherwise >
					<ee:transform doc:name="Transform Message" doc:id="f3a24a76-497a-4116-b4de-e3977c31c3ff" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/xml

ns soapenv http://schemas.xmlsoap.org/soap/envelope
---
{
	soapenv#soapEnvelope:{
    soapenv#Body:{
    
           soapenv#Fault:{
			faultcode: (error.errorType.namespace default "") ++ "-" ++ (error.errorType.identifier default "") ,
			faultString: error.detailedDescription
	}
	}
	}
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</otherwise>
			</choice>
		</on-error-continue>
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="2945706c-8a30-46f8-9bb5-74be8ae29398" type="CONNECTIVITY">
			<choice doc:name="Choice" doc:id="6a44abb4-4aa1-4169-9339-74e5ab2255f8" >
				<when expression="#[vars.assetType != 'soap']">
					<ee:transform doc:name="Transform Message" doc:id="547ec1bc-fd67-4880-a223-78085e685e17" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"exception":
	[{
		"errorCode":(error.errorType.namespace default "") ++ "::" ++ (error.errorType.identifier default ""),
		"errorMessage":vars.errorDescription 
	}]
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</when>
				<otherwise >
					<ee:transform doc:name="Transform Message" doc:id="c113f0bb-5b85-4eef-be50-38d26691d55d" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/xml

ns soapenv http://schemas.xmlsoap.org/soap/envelope
---
{
	soapenv#soapEnvelope:{
    soapenv#Body:{
    
           soapenv#Fault:{
			faultcode: (error.errorType.namespace default "") ++ "-" ++ (error.errorType.identifier default "") ,
			faultString: error.detailedDescription
	}
	}
	}
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</otherwise>
			</choice>
		</on-error-continue>
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="0f0beed1-fb11-4c76-a731-45c9ccfe21b6" type="SECURITY">
			<choice doc:name="Choice" doc:id="b5acd41e-79a2-48c2-ba05-43043d1b4fb6" >
				<when expression="#[vars.assetType != 'soap']">
					<ee:transform doc:name="Transform Message" doc:id="ca9efeea-25c1-4282-9656-2ce53a0c0320" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"exception":
	[{
		"errorCode":(error.errorType.namespace default "") ++ "::" ++ (error.errorType.identifier default ""),
		"errorMessage":vars.errorDescription 
	}]
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</when>
				<otherwise >
					<ee:transform doc:name="Transform Message" doc:id="e40f524b-9234-4778-a95e-d6743e5ff571" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/xml

ns soapenv http://schemas.xmlsoap.org/soap/envelope
---
{
	soapenv#soapEnvelope:{
    soapenv#Body:{
    
           soapenv#Fault:{
			faultcode: (error.errorType.namespace default "") ++ "-" ++ (error.errorType.identifier default "") ,
			faultString: error.detailedDescription
	}
	}
	}
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</otherwise>
			</choice>
		</on-error-continue>
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="37df5d3e-0f29-4e17-ada2-beca663c6d45" type="EXPRESSION">
			<choice doc:name="Choice" doc:id="4bb51833-8aa3-4217-a1e7-42605ce4ea34" >
				<when expression="#[vars.assetType != 'soap']">
					<ee:transform doc:name="Transform Message" doc:id="333ecd3a-4d31-480a-90f9-23304fe86ca4" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"exception":
	[{
		"errorCode":(error.errorType.namespace default "") ++ "::" ++ (error.errorType.identifier default ""),
		"errorMessage":vars.errorDescription 
	}]
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</when>
				<otherwise >
					<ee:transform doc:name="Transform Message" doc:id="9f6e9712-c1e4-402c-aaa1-3ae8e3255fbb" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/xml

ns soapenv http://schemas.xmlsoap.org/soap/envelope
---
{
	soapenv#soapEnvelope:{
    soapenv#Body:{
    
           soapenv#Fault:{
			faultcode: (error.errorType.namespace default "") ++ "-" ++ (error.errorType.identifier default "") ,
			faultString: error.detailedDescription
	}
	}
	}
}]]></ee:set-payload>
						</ee:message>
					</ee:transform>
				</otherwise>
			</choice>
		</on-error-continue>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="b5d32fd7-15ce-4f08-bcb9-f7dd868815ca" type="ANY" >
			<logger level="INFO" doc:name="Logger" doc:id="f34afc53-f2eb-48d4-99ab-063e2b238f9f" message="#[error.detailedDescriptions]"/>
		</on-error-propagate>
	</error-handler>
	
</mule>
